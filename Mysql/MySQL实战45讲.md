

### 09 | 普通索引和唯一索引,应该怎么选择

  * 查询过程

    - InnoDB的数据是按数据页为单位来读写的.当需要读一条记录的时候,是以页为单位,整体读入内存.每个数据页的大小默认是16kb.


  * 更新过程

    - 当需要更新一个数据页时,如果数据页在内存中就直接更新,否则,InnoDB会将更新操作缓存在change buffer中,这样就不需要从磁盘中读入这个数据页了.

    - 将change buffer中的操作应用的原数据页,得到更新结果的过程称为merge.访问这个数据页会触发merge,此外系统后台线程会定期merge.数据库正常关闭(shutdown),也会执行merge操作.

    - 将更新操作先记录在change buffer,减少读磁盘,语句的执行速度会得到提升.还能避免占用内存,提高内存利用率.

    - 唯一索引的更新不能使用change buffer,因为先要读入内存,检查唯一性.

### 10 | 怎么给字符串加索引

  1. 直接创建完整索引，这样可能比较占用空间

  2. 创建前缀索引，节省空间，但会增加查询扫描行数，并且不能使用覆盖索引

  3. 倒序存储，再创建前缀索引，用于绕过字符串本身前缀的区分度不够的问题（如身份证号）

  4. 创建 hash 字段索引，查询性能稳定，有额外的存储和计算消耗，跟第三种方式一样，都不支持范围扫描。
